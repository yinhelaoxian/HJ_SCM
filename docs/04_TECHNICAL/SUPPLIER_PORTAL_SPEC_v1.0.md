# 采购协同门户规范 v1.0

**文档版本**: v1.0  
**状态**: Draft  
**生效日期**: 2026-02-14  
**适用范围**: HJ_SCM 供应商协同门户  

---

## 1. 概述

### 1.1 功能范围

| 功能点 | 优先级 | 说明 |
|--------|--------|------|
| 订单确认 | P0 | ASN 确认、订单承诺 |
| 发货通知 | P0 | 发货录入、物流更新 |
| 质检上传 | P0 | COA/质检报告上传 |
| 绩效看板 | P1 | OTD、质量评分可视化 |
| 移动端适配 | P1 | 响应式设计 |

### 1.2 业务场景

| 场景 | 用户 | 需求 |
|------|------|------|
| Bühler 订单确认 | 供应商 | 快速响应、批量确认 |
| 宁波天阁发货 | 仓库 | 物流更新、ASN 上传 |
| 苏州联达质检 | 供应商 | COA 报告上传 |
| 供应商绩效 | 采购 | 实时评分查看 |

---

## 2. 移动端 UI 设计

### 2.1 订单确认界面

```
┌─────────────────────────────────────────────┐
│  ☰  订单确认                    🔔 3       │
├─────────────────────────────────────────────┤
│                                             │
│  【待确认订单】                               │
│                                             │
│  ┌─────────────────────────────────────┐  │
│  │ PO-2026-001  │  状态：待确认        │  │
│  │ Bühler 德国  │  交期：2026-02-28   │  │
│  │                                     │  │
│  │ HJ-M05  DC电机  500件  ¥160,000    │  │
│  │ HJ-SP03  弹簧件  2000件 ¥40,000    │  │
│  │                                     │  │
│  │ 截止：2026-02-15  剩余：3天        │  │
│  │                                     │  │
│  │ [确认订单]  [有异议]               │  │
│  └─────────────────────────────────────┘  │
│                                             │
│  ┌─────────────────────────────────────┐  │
│  │ PO-2026-002  │  状态：待确认        │  │
│  │ 宁波天阁     │  交期：2026-03-05   │  │
│  │                                     │  │
│  │ HJ-LA15  线性推杆  3000件 ¥90,000 │  │
│  │                                     │  │
│  │ 截止：2026-02-20  剩余：8天        │  │
│  │                                     │  │
│  │ [确认订单]  [有异议]               │  │
│  └─────────────────────────────────────┘  │
│                                             │
│  【已确认订单】                               │
│  ┌─────────────────────────────────────┐  │
│  │ PO-2025-198  │  ✅ 已确认          │  │
│  │ 苏州联达     │  交期：2026-02-10   │  │
│  └─────────────────────────────────────┘  │
│                                             │
└─────────────────────────────────────────────┘
```

### 2.2 发货通知界面

```
┌─────────────────────────────────────────────┐
│  ☰  发货通知                    🔔 1       │
├─────────────────────────────────────────────┤
│                                             │
│  【待发货订单】                               │
│                                             │
│  ┌─────────────────────────────────────┐  │
│  │ PO-2026-001  │  确认交期：02-28    │  │
│  │ Bühler      │  发货状态：未发货    │  │
│  │                                     │  │
│  │ 数量：500件  │  重量：120kg       │  │
│  │                                     │  │
│  │ [填写发货信息]                      │  │
│  └─────────────────────────────────────┘  │
│                                             │
│  【已发货】                                  │
│  ┌─────────────────────────────────────┐  │
│  │ PO-2025-195  │  🚚 已发货         │  │
│  │ 宁波天阁     │  物流：DHL 123456  │  │
│  │                                     │  │
│  │ 发货：02-08  │  预计到货：02-12   │  │
│  │                                     │  │
│  │ [查看物流]  [更新位置]             │  │
│  └─────────────────────────────────────┘  │
│                                             │
└─────────────────────────────────────────────┘
```

### 2.3 质检上传界面

```
┌─────────────────────────────────────────────┐
│  ☰  质检上传                    🔔 2       │
├─────────────────────────────────────────────┤
│                                             │
│  【待上传 COA】                              │
│                                             │
│  ┌─────────────────────────────────────┐  │
│  │ PO-2026-001  │  物料：HJ-M05      │  │
│  │ Bühler      │  批次：BATCH-001    │  │
│  │                                     │  │
│  │ [📷 拍照上传]  [📄 上传 PDF]       │  │
│  │                                     │  │
│  │ 当前：无                            │  │
│  │ 截止：到货后 3 天内                │  │
│  └─────────────────────────────────────┘  │
│                                             │
│  【已上传】                                  │
│  ┌─────────────────────────────────────┐  │
│  │ PO-2025-195  │  ✅ COA 已上传     │  │
│  │ 宁波天阁     │  批次：BATCH-088   │  │
│  │                                     │  │
│  │ [查看报告]  [重新上传]             │  │
│  └─────────────────────────────────────┘  │
│                                             │
└─────────────────────────────────────────────┘
```

### 2.4 绩效看板界面

```
┌─────────────────────────────────────────────┐
│  ☰  绩效看板                    📊         │
├─────────────────────────────────────────────┤
│                                             │
│  【综合评分】                                 │
│  ┌─────────────────────────────────────┐  │
│  │                                     │  │
│  │          78 分                      │  │
│  │        ████████░░                 │  │
│  │                                     │  │
│  │  排名：3/5    │  较上月：📉 -3    │  │
│  └─────────────────────────────────────┘  │
│                                             │
│  【OTD 趋势】                                │
│  ┌─────────────────────────────────────┐  │
│  │  100% │   ╱───                     │  │
│  │   90% │  ╱                          │  │
│  │   80% │ ─                            │  │
│  │   70% │╱                            │  │
│  │   60% │                             │  │
│  │      └───────────────────────       │  │
│  │       9月  10月  11月  12月  1月    │  │
│  └─────────────────────────────────────┘  │
│                                             │
│  【质量评分】                                │
│  ┌─────────────────────────────────────┐  │
│  │  来料合格率：96%    │  质检通过率：98%│  │
│  │  批次合格率：94%   │  投诉次数：1    │  │
│  └─────────────────────────────────────┘  │
│                                             │
│  【得分明细】                                │
│  ┌─────────────────────────────────────┐  │
│  │  交付  ████████░░  72分           │  │
│  │  质量  █████████░  85分           │  │
│  │  价格  ██████████  92分           │  │
│  │  服务  ████████░░  75分           │  │
│  └─────────────────────────────────────┘  │
│                                             │
└─────────────────────────────────────────────┘
```

---

## 3. 审批流设计

### 3.1 订单确认流程

```
┌─────────────────────────────────────────────────────────────────┐
│                     订单确认流程                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────┐                                                     │
│  │ 系统推送 │  PO 创建成功，发送邮件+短信                          │
│  └────┬────┘                                                     │
│       │                                                           │
│       ▼                                                           │
│  ┌─────────┐                                                     │
│  │ 供应商登录│  移动端/PC 端登录                                 │
│  └────┬────┘                                                     │
│       │                                                           │
│       ▼                                                           │
│  ┌─────────────────────────────────────────────┐                 │
│  │ 订单确认                                     │                 │
│  │ - 确认数量、交期                             │                 │
│  │ - 如有异议，填写原因                         │                 │
│  └────────────────────┬────────────────────────┘                 │
│                       │                                           │
│          ┌────────────┼────────────┐                            │
│          ▼            ▼            ▼                            │
│    ┌──────────┐ ┌──────────┐ ┌──────────┐                    │
│    │ 确认订单 │ │ 确认+变更│ │ 拒绝     │                    │
│    └────┬─────┘ └────┬─────┘ └────┬─────┘                    │
│         │            │            │                            │
│         ▼            ▼            ▼                            │
│    ┌─────────────────────────────────────────────┐             │
│    │ 系统处理                                     │             │
│    │ - 更新 PO 状态                              │             │
│    │ - 触发 MRP 齐套检查                        │             │
│    │ - 通知采购员                               │             │
│    └─────────────────────────────────────────────┘             │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 发货通知流程

```
┌─────────────────────────────────────────────────────────────────┐
│                     发货通知流程                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────┐                 │
│  │ 供应商填写发货信息                           │                 │
│  │ - 发货日期                                  │                 │
│  │ - 物流公司 + 运单号                         │                 │
│  │ - 车牌号（整车）                            │                 │
│  │ - 包装数量                                  │                 │
│  │ - 上传物流单据                              │                 │
│  └────────────────────┬────────────────────────┘                 │
│                       │                                           │
│                       ▼                                           │
│  ┌─────────────────────────────────────────────┐                 │
│  │ 系统生成 ASN                                │                 │
│  │ - ASN 编号                                  │                 │
│  │ - 发货清单                                 │                 │
│  │ - 预计到货时间                             │                 │
│  └────────────────────┬────────────────────────┘                 │
│                       │                                           │
│                       ▼                                           │
│  ┌─────────────────────────────────────────────┐                 │
│  │ 物流跟踪更新（可选）                         │                 │
│  │ - 当前位置更新                              │                 │
│  │ - 异常状态通知                              │                 │
│  └────────────────────┬────────────────────────┘                 │
│                       │                                           │
│                       ▼                                           │
│  ┌─────────────────────────────────────────────┐                 │
│  │ 到货确认                                    │                 │
│  │ - 仓库扫码收货                              │                 │
│  │ - 对比 ASN                                 │                 │
│  │ - 更新 PO 状态                             │                 │
│  └─────────────────────────────────────────────┘                 │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. RBAC 权限设计

### 4.1 角色定义

| 角色 | 代码 | 权限 |
|------|------|------|
| 供应商管理员 | SUP_ADMIN | 全部权限 |
| 供应商采购 | SUP_BUYER | 订单确认、发货通知 |
| 供应商质检 | SUP_QA | COA 上传 |
| 供应商财务 | SUP_FIN | 查看权限 |
| 采购员（我方） | BUYER | 供应商管理、绩效查看 |
| 采购经理 | BUYER_MGR | 审批权限 |

### 4.2 权限矩阵

| 功能 | SUP_ADMIN | SUP_BUYER | SUP_QA | BUYER | BUYER_MGR |
|------|-----------|-----------|--------|-------|-----------|
| 查看订单 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 确认订单 | ✅ | ✅ | ❌ | ❌ | ❌ |
| 发货通知 | ✅ | ✅ | ❌ | ❌ | ❌ |
| COA 上传 | ✅ | ❌ | ✅ | ❌ | ❌ |
| 查看绩效 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 供应商管理 | ❌ | ❌ | ❌ | ✅ | ✅ |
| 审批异常 | ❌ | ❌ | ❌ | ✅ | ✅ |

---

## 5. API 接口设计

### 5.1 订单确认接口

```java
/**
 * 订单确认接口
 */
@RestController
@RequestMapping("/api/supplier-portal/orders")
public class OrderConfirmationController {
    
    /**
     * 获取待确认订单列表
     */
    @GetMapping("/pending")
    public List<OrderDTO> getPendingOrders(
            @RequestParam String supplierCode) {
        return orderService.getPendingOrders(supplierCode);
    }
    
    /**
     * 确认订单
     */
    @PostMapping("/{orderId}/confirm")
    public OrderConfirmationResult confirmOrder(
            @PathVariable String orderId,
            @RequestBody OrderConfirmationRequest request) {
        return orderService.confirmOrder(orderId, request);
    }
    
    /**
     * 订单有异议
     */
    @PostMapping("/{orderId}/dispute")
    public OrderDisputeResult disputeOrder(
            @PathVariable String orderId,
            @RequestBody OrderDisputeRequest request) {
        return orderService.disputeOrder(orderId, request);
    }
}

/**
 * 确认请求
 */
@Data
public class OrderConfirmationRequest {
    private String supplierCode;
    private String confirmedBy;
    private LocalDate confirmedDate;
    private LocalDate deliveryDate;
    private String remarks;
    private List<OrderLineConfirmation> lineConfirmations;
}

/**
 * 确认结果
 */
@Data
public class OrderConfirmationResult {
    private String orderId;
    private String status;
    private LocalDate confirmedDate;
    private String traceId;
    private List<String> warnings;
}
```

### 5.2 发货通知接口

```java
/**
 * 发货通知接口
 */
@RestController
@RequestMapping("/api/supplier-portal/shipments")
public class ShipmentController {
    
    /**
     * 创建 ASN
     */
    @PostMapping
    public ASNResult createASN(@RequestBody ASNRequest request) {
        return asnService.createASN(request);
    }
    
    /**
     * 更新物流位置
     */
    @PostMapping("/{asnId}/tracking")
    public void updateTracking(
            @PathVariable String asnId,
            @RequestBody TrackingUpdateRequest request) {
        trackingService.updateLocation(asnId, request);
    }
    
    /**
     * 上传物流单据
     */
    @PostMapping("/{asnId}/documents")
    public List<DocumentUploadResult> uploadDocuments(
            @PathVariable String asnId,
            @RequestParam("files") MultipartFile[] files) {
        return documentService.upload(asnId, files);
    }
}
```

### 5.3 COA 上传接口

```java
/**
 * COA 上传接口
 */
@RestController
@RequestMapping("/api/supplier-portal/coa")
public class COAController {
    
    /**
     * 上传 COA
     */
    @PostMapping("/upload")
    public COAResult uploadCOA(
            @RequestParam("file") MultipartFile file,
            @RequestParam String orderId,
            @RequestParam String batchNo,
            @RequestParam String materialCode) {
        
        // 1. 验证文件
        validateFile(file);
        
        // 2. 上传存储
        String fileUrl = fileStorageService.store(file);
        
        // 3. 保存记录
        COARecord record = COARecord.builder()
            .orderId(orderId)
            .batchNo(batchNo)
            .materialCode(materialCode)
            .fileUrl(fileUrl)
            .fileName(file.getOriginalFilename())
            .uploadedAt(LocalDateTime.now())
            .status("PENDING_REVIEW")
            .build();
        
        return COAResult.builder()
            .coaId(record.getId())
            .status("UPLOADED")
            .traceId(generateTraceId())
            .build();
    }
}
```

---

## 6. 验收标准

### 6.1 功能验收

| 场景 | 输入 | 预期输出 | 验收条件 |
|------|------|---------|----------|
| 订单确认 | 供应商确认 PO-001 | PO 状态更新 | 100% 准确 |
| 发货通知 | 填写物流信息 | ASN 生成 | 正确生成 |
| COA 上传 | PDF 文件 | 记录保存 | 文件可下载 |
| 绩效看板 | 供应商查看 | 评分展示 | 数据准确 |

### 6.2 性能验收

| 指标 | 目标值 | 测量方法 |
|------|--------|----------|
| 页面加载 | < 3s | 移动端测试 |
| 订单确认 | < 1s | API 响应 |
| 文件上传 | < 5s | 5MB 文件 |

---

## 7. 风险与应对

### 7.1 技术风险

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| 移动端兼容性 | 中 | 中 | 响应式设计 + 多端测试 |
| 文件上传失败 | 低 | 中 | 重试机制 |
| 实时性不足 | 低 | 中 | WebSocket 推送 |

### 7.2 业务风险

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| 供应商不配合 | 中 | 中 | 培训 + 激励机制 |
| 数据泄露 | 低 | 高 | 权限控制 + 加密 |

---

## 附录

### A. 相关文档

| 文档 | 路径 |
|------|------|
| MRP 引擎规范 | `docs/04_TECHNICAL/MRP_ENGINE_SPEC_v1.0.md` |
| Trace ID 规范 | `docs/04_TECHNICAL/TRACE_ID_SPECIFICATION_v1.1.md` |

---

> **文档版本**: v1.0  
> **最后更新**: 2026-02-14  
> **状态**: 待评审
