# 生产执行模块规范 v1.0

**文档版本**: v1.0  
**状态**: Draft  
**生效日期**: 2026-02-14  
**适用范围**: HJ_SCM 生产执行模块  

---

## 1. 概述

### 1.1 功能范围

| 功能点 | 优先级 | 说明 |
|--------|--------|------|
| 排产管理 | P0 | 基于 MPS 的详细排产 |
| 投料管理 | P0 | 生产领料、批次追踪 |
| 批次追溯 | P0 | 医养追溯核心 |
| 完工汇报 | P0 | 生产报工、产出记录 |
| 异常处理 | P1 | 生产异常记录 |

### 1.2 业务场景

| 场景 | 痛点 | 解决方案 |
|------|------|----------|
| 青岛 A 线超负荷 | 112% 利用率 | 排产优化、转产建议 |
| 医养追溯 | 批次记录不全 | 全链路批次追踪 |
| MTO 订单 | 齐套率低 | 投料联动 MRP |
| 泰国产能爬坡 | 利用率仅 43% | 产线协同 |

---

## 2. 功能设计

### 2.1 排产管理

```
┌─────────────────────────────────────────────────────────────────┐
│                        排产管理                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  【工单列表】                                                    │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │ 工单号  │ 物料   │ 数量 │ 交期   │ 产线  │ 状态     │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ MO-001  │ HJ-LA23│ 500  │ 02-20 │ 青岛A │ 已下发  │  │
│  │ MO-002  │ HJ-LA15│ 300  │ 02-21 │ 青岛B │ 待排产  │  │
│  │ MO-003  │ HJ-M05 │ 200  │ 02-22 │ 泰国  │ 待排产  │  │
│  └─────────────────────────────────────────────────────────┘  │
│                                                                  │
│  【甘特图视图】                                                  │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │ 青岛A线 ████████████████ MO-001 (02-15~02-20)          │  │
│  │         ██████████████ MO-004 (02-21~02-25)             │  │
│  │ 青岛B线 ███████████ MO-002 (02-16~02-21)               │  │
│  │         ███████████ MO-005 (02-22~02-26)               │  │
│  │ 泰国线  ███████ MO-003 (02-18~02-22)                  │  │
│  │         ████████ MO-006 (02-23~02-28)                 │  │
│  └─────────────────────────────────────────────────────────┘  │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 投料管理

```
┌─────────────────────────────────────────────────────────────────┐
│                        投料管理                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  【工单：MO-001】                                                │
│  物料：HJ-LA23  │ 数量：500 件 │ 产线：青岛A                  │
│                                                                  │
│  【物料清单】                                                    │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │ 物料    │ 需求   │ 已领  │ 待领  │ 批次   │ 状态      │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ HJ-M05  │ 500   │ 0    │ 500  │ -     │ [扫码领料]│  │
│  │ HJ-SP03 │ 1000  │ 200  │ 800  │ BATCH │ [扫码领料]│  │
│  └─────────────────────────────────────────────────────────┘  │
│                                                                  │
│  【领料记录】                                                    │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │ 时间        │ 物料   │ 数量 │ 批次   │ 操作员  │ 领料单号 │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ 02-15 08:30│ HJ-M05 │ 200  │ BATCH-1│ 张三   │ GI-001  │  │
│  └─────────────────────────────────────────────────────────┘  │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 2.3 批次追溯（医养核心）

```
┌─────────────────────────────────────────────────────────────────┐
│                        批次追溯                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  【工单批次追溯】                                                │
│                                                                  │
│  成品：HJ-LA23              批次：BATCH-OUT-001                  │
│  生产日期：2026-02-15       数量：500 件                         │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │ 原料批次          │ 物料   │ 数量 │ 供应商  │ 质检状态   │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ BATCH-IN-088    │ HJ-M05 │ 500  │ Buhler  │ ✅ 合格   │  │
│  │ BATCH-IN-089    │ HJ-SP03 │ 1000 │ 苏州联达 │ ✅ 合格   │  │
│  └─────────────────────────────────────────────────────────┘  │
│                                                                  │
│  【正向追溯】                                                    │
│  成品批次 → 原料批次 → 供应商批次 → 原材料检验记录               │
│                                                                  │
│  【逆向追溯】                                                    │
│  客户投诉 → 成品批次 → 原料批次 → 供应商批次                    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 与 MRP 接口设计

### 3.1 接口定义

```java
/**
 * MRP → 生产执行接口
 */
public interface MrpToProductionService {
    
    /**
     * MRP 生成工单
     */
    ProductionOrder createProductionOrder(MrpOrder mrpOrder);
    
    /**
     * MRP 更新工单
     */
    void updateProductionOrder(String orderId, MrpOrder mrpOrder);
    
    /**
     * 查询工单状态
     */
    ProductionOrderStatus getOrderStatus(String orderId);
}

/**
 * 生产执行 → MRP 接口
 */
public interface ProductionToMrpService {
    
    /**
     * 汇报完工
     */
    void reportCompletion(String orderId, CompletionReport report);
    
    /**
     * 汇报投料
     */
    void reportIssue(String orderId, IssueReport report);
    
    /**
     * 汇报异常
     */
    void reportException(String orderId, ProductionException exception);
    
    /**
     * 查询物料需求
     */
    List<MaterialRequirement> getMaterialRequirements(String orderId);
}
```

### 3.2 数据流

```
MRP 引擎                              生产执行
    │                                    │
    │  createProductionOrder(MO)         │
    ├───────────────────────────────────▶│ 生成工单
    │                                    │
    │                                    │ 投料操作
    │  reportIssue()                     │
    │◀──────────────────────────────────┤ 扣减库存
    │                                    │
    │                                    │ 完工汇报
    │  reportCompletion()                 │
    │◀──────────────────────────────────┤ 更新工单
    │                                    │
    │  触发齐套检查                       │
    └────────────────────────────────────┘
```

---

## 4. 验收标准

### 4.1 功能验收

| 场景 | 输入 | 预期输出 | 验收条件 |
|------|------|---------|----------|
| 工单创建 | MRP 结果 | 正确创建 | 100% 准确 |
| 投料记录 | 扫码领料 | 库存扣减 | 误差 < 0.01% |
| 完工汇报 | 报工数据 | 状态更新 | 正确更新 |
| 批次追溯 | 成品批次 | 完整链路 | 100% 可追溯 |

### 4.2 性能验收

| 指标 | 目标值 |
|------|--------|
| 工单创建 | < 500ms |
| 投料扫码 | < 200ms |
| 完工汇报 | < 500ms |
| 批次查询 | < 300ms |

---

## 5. 风险与应对

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| 投料数据不准 | 中 | 高 | 扫码校验 |
| 批次关联错误 | 低 | 高 | 强校验 |
| 实时性不足 | 低 | 中 | 事件驱动 |

---

> **文档版本**: v1.0  
> **最后更新**: 2026-02-14  
> **状态**: 待评审
